"{\n  \"name\": \"My workflow 16\",\n  \"nodes\": [\n    {\n      \"parameters\": {\n        \"updates\": [\n          \"messages\"\n        ],\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.whatsAppTrigger\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -400,\n        512\n      ],\n      \"id\": \"0f258b11-1911-4b3b-ba9c-ebce918f2029\",\n      \"name\": \"WhatsApp Trigger\",\n      \"webhookId\": \"d3978cae-2aca-4553-8ac7-ab89068deabc\"\n    },\n    {\n      \"parameters\": {\n        \"promptType\": \"define\",\n        \"text\": \"={{ $json.text }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are a helpful assistant called Sam.\\n\\nYou are currently talking to  {{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}\\n\\nThe current date and time is {{ $now.toString() }}\"\n        }\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"typeVersion\": 1.9,\n      \"position\": [\n        272,\n        624\n      ],\n      \"id\": \"3b302725-e7ea-405c-8262-56561b058057\",\n      \"name\": \"AI Agent\"\n    },\n    {\n      \"parameters\": {\n        \"sessionIdType\": \"customKey\",\n        \"sessionKey\": \"={{ $('WhatsApp Trigger').item.json.messages[0].from }}\",\n        \"contextWindowLength\": 20\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"typeVersion\": 1.3,\n      \"position\": [\n        192,\n        832\n      ],\n      \"id\": \"7899ec9d-a1ee-4851-838a-e9b4eced901c\",\n      \"name\": \"Simple Memory\"\n    },\n    {\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"id\": \"b7b64446-f1ea-4622-990c-22f3999a8269\",\n                    \"leftValue\": \"={{ $json.messages[0].audio }}\",\n                    \"rightValue\": \"\",\n                    \"operator\": {\n                      \"type\": \"object\",\n                      \"operation\": \"exists\",\n                      \"singleValue\": true\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Voice\"\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"id\": \"202af928-a324-411a-bf15-68a349e7bf9e\",\n                    \"leftValue\": \"={{ $json.messages[0].image }}\",\n                    \"rightValue\": \"\",\n                    \"operator\": {\n                      \"type\": \"object\",\n                      \"operation\": \"exists\",\n                      \"singleValue\": true\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Image\"\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"leftValue\": \"={{ $json.messages[0].text.body }}\",\n                    \"rightValue\": \"\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"exists\",\n                      \"singleValue\": true\n                    },\n                    \"id\": \"08fd0c80-307e-4f45-b1de-35192ee4ec5e\"\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Text\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.switch\",\n      \"typeVersion\": 3.2,\n      \"position\": [\n        -224,\n        512\n      ],\n      \"id\": \"2ad53146-0f9d-447d-b074-7082dfedfc50\",\n      \"name\": \"Check Input Type\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"media\",\n        \"operation\": \"mediaUrlGet\",\n        \"mediaGetId\": \"={{ $('WhatsApp Trigger').item.json.messages[0].image.id }}\"\n      },\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        128,\n        352\n      ],\n      \"id\": \"17690594-162d-4b5a-8632-2de418007370\",\n      \"name\": \"Get Image URL\",\n      \"webhookId\": \"280bd5de-32d7-4d8f-93d2-e91e3b0bc161\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        288,\n        352\n      ],\n      \"id\": \"a9f1d946-7bd4-4b92-8065-e8dbf0d6a87f\",\n      \"name\": \"Download Image\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"image\",\n        \"operation\": \"analyze\",\n        \"modelId\": {\n          \"__rl\": true,\n          \"value\": \"chatgpt-4o-latest\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"CHATGPT-4O-LATEST\"\n        },\n        \"text\": \"=Describe the image in detail.\",\n        \"inputType\": \"base64\",\n        \"options\": {}\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.8,\n      \"position\": [\n        448,\n        352\n      ],\n      \"id\": \"494b3f0b-338a-4951-81a1-e70cb295d082\",\n      \"name\": \"Analyze Image\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"67552183-de2e-494a-878e-c2948e8cb6bb\",\n              \"name\": \"text\",\n              \"value\": \"=# The user provided the following image and text.\\n\\n## IMAGE CONTENT:\\n{{ $json.content }}\\n\\n## USER MESSAGE:\\n{{ $('WhatsApp Trigger').item.json.messages[0].image.caption || \\\"Describe the image\\\" }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        608,\n        352\n      ],\n      \"id\": \"53ba6374-0793-4580-85a8-2f4d6b3c201e\",\n      \"name\": \"Image + Text Prompt\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"media\",\n        \"operation\": \"mediaUrlGet\",\n        \"mediaGetId\": \"={{ $('WhatsApp Trigger').item.json.messages[0].audio.id }}\"\n      },\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        128,\n        80\n      ],\n      \"id\": \"09eb652e-575d-46c8-b0e8-e1736bdd6ac9\",\n      \"name\": \"Get Audio URL\",\n      \"webhookId\": \"87caa300-7204-47b5-959a-94f4a8fbf8cf\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        288,\n        80\n      ],\n      \"id\": \"e27c8312-b441-4434-b4fc-694502e38de4\",\n      \"name\": \"Download Audio\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"audio\",\n        \"operation\": \"transcribe\",\n        \"options\": {}\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.8,\n      \"position\": [\n        448,\n        80\n      ],\n      \"id\": \"7420a746-11a7-435a-abb2-34c9f44d7b92\",\n      \"name\": \"Transcribe Audio\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"219577d5-b028-48fc-90be-980f4171ab68\",\n              \"name\": \"text\",\n              \"value\": \"={{ $json.text }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        608,\n        80\n      ],\n      \"id\": \"24214846-a81e-4a31-8b85-19913157da24\",\n      \"name\": \"Audio Prompt\"\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\",\n            \"version\": 2\n          },\n          \"conditions\": [\n            {\n              \"id\": \"b9d1d759-f585-4791-a743-b9d72951e77c\",\n              \"leftValue\": \"={{ $('WhatsApp Trigger').item.json.messages[0].audio }}\",\n              \"rightValue\": \"\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              }\n            }\n          ],\n          \"combinator\": \"and\"\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2.2,\n      \"position\": [\n        608,\n        624\n      ],\n      \"id\": \"276db959-8eab-48b2-bc0d-5b0a364fa896\",\n      \"name\": \"If\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"audio\",\n        \"input\": \"={{ $('AI Agent').item.json.output }}\",\n        \"options\": {}\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.8,\n      \"position\": [\n        944,\n        608\n      ],\n      \"id\": \"30e84bf2-ce3f-492a-b499-a420f3d22848\",\n      \"name\": \"Generate Audio\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"send\",\n        \"phoneNumberId\": \"175940715605000\",\n        \"recipientPhoneNumber\": \"={{ $('Check Input Type').item.json.contacts[0].wa_id }}\",\n        \"messageType\": \"audio\",\n        \"mediaPath\": \"useMedian8n\",\n        \"additionalFields\": {}\n      },\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        1312,\n        608\n      ],\n      \"id\": \"75013755-4988-41f7-8a13-1f0651423cd2\",\n      \"name\": \"Respond with Audio\",\n      \"webhookId\": \"d18b2c98-84e4-43cf-a532-0c47d5161684\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"send\",\n        \"phoneNumberId\": \"175940715605000\",\n        \"recipientPhoneNumber\": \"={{ $('WhatsApp Trigger').item.json.messages[0].from }}\",\n        \"textBody\": \"={{ $json.output }}\",\n        \"additionalFields\": {}\n      },\n      \"type\": \"n8n-nodes-base.whatsApp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        944,\n        800\n      ],\n      \"id\": \"265169a6-6e8c-492b-a156-8519f82e18e6\",\n      \"name\": \"Respond with Text\",\n      \"webhookId\": \"23834751-5066-48ba-8e19-549680df2b27\"\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Loop over input items and change the MIME type of binary data\\nfor (const item of $input.all()) {\\n  // Check if the item has binary data\\n  if (item.binary) {\\n    // Find the binary property name (assuming there's at least one)\\n    const binaryPropertyNames = Object.keys(item.binary);\\n    \\n    for (const propName of binaryPropertyNames) {\\n      // If the MIME type is 'audio/mp3', change it to 'audio/mpeg'\\n      if (item.binary[propName].mimeType === 'audio/mp3') {\\n        item.binary[propName].mimeType = 'audio/mpeg';\\n      }\\n    }\\n  }\\n}\\n\\nreturn $input.all();\"\n      },\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        1120,\n        608\n      ],\n      \"id\": \"2f36bf33-5c1c-4be3-ab79-c165770b795c\",\n      \"name\": \"Fix Mime Type\"\n    },\n    {\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"typeVersion\": 1.2,\n      \"position\": [\n        48,\n        832\n      ],\n      \"id\": \"84c591b9-3732-4290-8608-ec36accc7f3a\",\n      \"name\": \"OpenAI Chat Model\"\n    },\n    {\n      \"parameters\": {\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        }\n      },\n      \"type\": \"n8n-nodes-base.googleSheetsTool\",\n      \"typeVersion\": 4.6,\n      \"position\": [\n        352,\n        848\n      ],\n      \"id\": \"1a9f4802-482a-46c0-a41b-5915ce04c498\",\n      \"name\": \"GetDataTools\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"append\",\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        }\n      },\n      \"type\": \"n8n-nodes-base.googleSheetsTool\",\n      \"typeVersion\": 4.6,\n      \"position\": [\n        528,\n        848\n      ],\n      \"id\": \"a9fa8a0e-f862-4963-9381-6dc12183ae03\",\n      \"name\": \"CreateDataTools\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"c05a7fbf-309a-407e-9fee-7e0b03f4a5c8\",\n              \"name\": \"text\",\n              \"value\": \"={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        48,\n        624\n      ],\n      \"id\": \"25a470bd-5824-4e08-85f4-e5212f0830d3\",\n      \"name\": \"Text\"\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"WhatsApp Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check Input Type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Simple Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check Input Type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Audio URL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Image URL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Text\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Image URL\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download Image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download Image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Analyze Image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Analyze Image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Image + Text Prompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Image + Text Prompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Audio URL\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download Audio\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download Audio\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Transcribe Audio\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Transcribe Audio\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Audio Prompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Audio Prompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Audio\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Respond with Text\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Audio\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Fix Mime Type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Fix Mime Type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond with Audio\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GetDataTools\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"CreateDataTools\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Text\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"active\": false,\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"1744a1aa-ce12-4c8e-9f25-c1d16e1139e6\",\n  \"meta\": {\n    \"instanceId\": \"d0c6caa43104486e5ee494993a0815949df114e58766b1cc158c3fe672c00e6a\"\n  },\n  \"id\": \"4hzO63UkXqH06OZY\",\n  \"tags\": []\n}"
